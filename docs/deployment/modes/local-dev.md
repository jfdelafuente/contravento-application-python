# Local Dev (SQLite) Deployment Mode

**Perfect for**: Daily development, quick prototyping, learning the codebase

**Command**: `./run-local-dev.sh` (Linux/Mac) or `.\run-local-dev.ps1` (Windows)

**Startup Time**: Instant (<30 seconds)

**Docker Required**: ‚ùå No

---

## Overview

The **local-dev** mode is the **fastest way** to start developing with ContraVento. It uses SQLite (file-based database) and runs directly on your machine without Docker overhead.

### When to Use This Mode

‚úÖ **Perfect for**:
- Daily development work
- Quick prototyping and testing
- Learning the codebase
- Working on trips, profiles, stats, social features
- Backend-only development

‚ùå **NOT suitable for**:
- Testing PostgreSQL-specific features (array columns, native UUIDs)
- Email testing with UI (MailHog)
- Redis caching/session testing
- Production-like environment simulation

### What's Included

| Component | Version | Notes |
|-----------|---------|-------|
| **Backend** | FastAPI | Hot reload enabled |
| **Database** | SQLite 3 | File: `backend/contravento_dev.db` |
| **Frontend** | Optional | Vite dev server (port 5173) |
| **Email** | Console logs | Emails printed to terminal (no UI) |
| **Cache** | None | Redis not needed for basic features |

### Key Features

- ‚ö° **Instant startup** - No Docker container overhead
- üéØ **Zero configuration** - Automatic setup with `--setup` flag
- üîÑ **Hot reload** - Backend and frontend auto-reload on code changes
- üíª **Cross-platform** - Works on Windows, macOS, Linux
- üì¶ **Minimal disk space** - ~50 MB (vs. ~500 MB for Docker)
- ‚úÖ **Auto-seeding** - Test users and data created automatically

---

## Prerequisites

### Required Software

#### For Backend (Always Required)

**Python 3.12+**:
```bash
python --version  # Must show 3.12 or higher
```

**Poetry** (Python dependency manager):
```bash
poetry --version

# If not installed:
pip install poetry
# Or with pipx (recommended):
pipx install poetry
```

#### For Frontend (Only with --with-frontend flag)

**Node.js 18+**:
```bash
node --version  # Must show v18.x or higher
```

**npm** (comes with Node.js):
```bash
npm --version  # Must show 9.x or higher
```

### System Requirements

| Resource | Minimum | Recommended |
|----------|---------|-------------|
| **RAM** | 2 GB | 4 GB |
| **Disk Space** | 500 MB | 2 GB (with frontend node_modules) |
| **CPU** | 2 cores | 4 cores |
| **OS** | Windows 10, macOS 11, Ubuntu 20.04 | Latest versions |

### Network Requirements

- **Ports**: 8000 (backend), 5173 (frontend - optional)
- **Internet**: Required for initial setup (dependency installation)

---

## Quick Start

### First-Time Setup

**Step 1**: Clone the repository
```bash
git clone https://github.com/your-org/contravento-application-python.git
cd contravento-application-python
```

**Step 2**: Run setup (one-time only)

**Linux/Mac**:
```bash
./run-local-dev.sh --setup
```

**Windows PowerShell**:
```powershell
.\run-local-dev.ps1 -Setup
```

**What setup does automatically**:
1. ‚úÖ Copies `backend/.env` from `backend/.env.dev.example`
2. ‚úÖ Generates random `SECRET_KEY` for JWT tokens
3. ‚úÖ Installs Python dependencies with `poetry install`
4. ‚úÖ Creates SQLite database with Alembic migrations
5. ‚úÖ Creates test users (admin, testuser, maria_garcia)
6. ‚úÖ Seeds data (achievements, cycling types)

**Estimated time**: 2-3 minutes on first run

**Step 3**: Verify it works

**Linux/Mac**:
```bash
./run-local-dev.sh
```

**Windows PowerShell**:
```powershell
.\run-local-dev.ps1
```

**Expected output**:
```
‚úÖ Starting backend at http://localhost:8000
‚ÑπÔ∏è  API Docs: http://localhost:8000/docs
‚ÑπÔ∏è  Press Ctrl+C to stop
```

**Step 4**: Test the API

Open your browser and navigate to:
- **Backend**: http://localhost:8000
- **API Documentation**: http://localhost:8000/docs
- **Health Check**: http://localhost:8000/health

---

## Configuration

### Environment Variables

The setup script creates `backend/.env` from `backend/.env.dev.example` with these defaults:

```bash
# Database
DATABASE_URL=sqlite:///./contravento_dev.db
DB_ECHO=false

# Security
SECRET_KEY=<auto-generated>  # 32+ character random string
BCRYPT_ROUNDS=4              # Fast hashing for development

# Tokens
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=30

# Email (Console mode for local-dev)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM=noreply@contravento.com
SMTP_TLS=true

# File uploads
UPLOAD_MAX_SIZE_MB=10
STORAGE_PATH=./storage

# CORS (Frontend origin)
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# Environment
APP_ENV=development
DEBUG=true
LOG_LEVEL=DEBUG
LOG_FORMAT=text
```

### Frontend Configuration (with --with-frontend)

The script auto-creates `frontend/.env.development` from `frontend/.env.development.example`:

```bash
VITE_API_URL=http://localhost:8000
VITE_TURNSTILE_SITE_KEY=1x00000000000000000000AA  # Cloudflare test key
VITE_ENV=development
VITE_DEBUG=true
```

**Important**: The frontend runs on port **5173** (Vite default) and uses a proxy to forward `/api/*` requests to the backend on port 8000. This eliminates CORS issues during development.

### Port Configuration

The backend port is **fully configurable** via environment variables. By default, the backend runs on port **8000**, but you can change it to any available port.

#### Configuration Methods

**Method 1: Environment Variable (Quick Override)**

```bash
# Linux/Mac
export BACKEND_PORT=9000
./run-local-dev.sh

# Windows PowerShell
$env:BACKEND_PORT = 9000
.\run-local-dev.ps1
```

**Method 2: Command Line (Uvicorn directly)**

```bash
cd backend
poetry run uvicorn src.main:app --reload --port 9000
```

**Priority Order**:
1. Exported environment variable (`export BACKEND_PORT=9000`)
2. Default fallback (`8000`)

#### Auto-Configuration

The `run-local-dev.sh` script **automatically configures** the frontend when you use `--with-frontend`:

```bash
export BACKEND_PORT=9000
./run-local-dev.sh --with-frontend
```

This automatically updates `frontend/.env.development` with:
```bash
VITE_API_URL=http://localhost:9000  ‚úÖ Auto-updated
```

#### Accessing Services with Custom Port

If you set `BACKEND_PORT=9000`:

- **Backend API**: http://localhost:9000 (instead of 8000)
- **API Docs**: http://localhost:9000/docs
- **Health Check**: http://localhost:9000/health
- **Frontend**: http://localhost:5173 (unchanged)
- **Database**: `backend/contravento_dev.db` (SQLite file)

#### Testing Scripts Auto-Configuration

All testing scripts automatically use the configured backend port:

```bash
export BACKEND_PORT=9000

# These scripts auto-connect to port 9000:
./scripts/run_smoke_tests.sh
./scripts/testing/gps/test-gps-quick.sh
```

#### Common Port Conflicts

If port 8000 is already in use:

```
ERROR: Port 8000 is already in use!
```

**Solution**:

```bash
# Option 1: Use different port
export BACKEND_PORT=9000
./run-local-dev.sh

# Option 2: Kill conflicting process
lsof -ti:8000 | xargs kill -9  # Linux/Mac
Get-NetTCPConnection -LocalPort 8000 | Stop-Process -Force  # Windows
```

### Test Users (Auto-Created)

| Username | Email | Password | Role |
|----------|-------|----------|------|
| **admin** | admin@contravento.com | AdminPass123! | ADMIN |
| **testuser** | test@example.com | TestPass123! | USER |
| **maria_garcia** | maria@example.com | SecurePass456! | USER |

### Seeded Data

**Achievements** (9 pre-configured):
- Primera Ruta, Explorador, Buen Compa√±ero, etc.

**Cycling Types** (8 pre-configured):
- Road, MTB, Gravel, Bikepacking, etc.

---

## Usage

### Daily Development Workflows

#### Scenario 1: Backend-Only Development

**Use when**: Working on APIs, business logic, models, database

**Command**:
```bash
# Linux/Mac
./run-local-dev.sh

# Windows
.\run-local-dev.ps1
```

**What starts**:
- Backend (FastAPI) at http://localhost:8000
- Hot reload enabled (auto-restart on `.py` file changes)

**Workflow**:
1. Edit files in `backend/src/`
2. Save the file
3. Server auto-reloads in ~5 seconds
4. Test at http://localhost:8000/docs

**Stop**: Press `Ctrl+C`

---

#### Scenario 2: Full-Stack Development

**Use when**: Working on features that need frontend + backend changes

**Command**:
```bash
# Linux/Mac
./run-local-dev.sh --with-frontend

# Windows
.\run-local-dev.ps1 -WithFrontend
```

**What starts**:
- Backend (FastAPI) at http://localhost:8000
- Frontend (Vite) at http://localhost:5173
- Hot Module Replacement (HMR) for React
- Hot reload for FastAPI

**First-time frontend setup**:
- Script auto-detects missing `node_modules` and runs `npm install`
- Script auto-creates `frontend/.env.development` from example

**Workflow**:
1. Open browser at http://localhost:5173 (frontend)
2. Edit code:
   - **Frontend changes** (`frontend/src/*.tsx`, `*.css`):
     - Save file ‚Üí Browser updates in <2 seconds **without page reload** (HMR)
   - **Backend changes** (`backend/src/*.py`):
     - Save file ‚Üí Server restarts in ~5-10 seconds
     - Refresh browser to see API changes
3. Test end-to-end functionality at http://localhost:5173

**Proxy behavior**:
- Frontend at http://localhost:5173 proxies `/api/*` to http://localhost:8000
- Configured in `frontend/vite.config.ts`:
  ```typescript
  proxy: {
    '/api': {
      target: 'http://localhost:8000',
      changeOrigin: true,
    }
  }
  ```
- No CORS issues during development

**Stop**: Press `Ctrl+C` (stops both services)

---

#### Scenario 3: Reset Database

**Use when**:
- Database is corrupted
- Testing new migrations from scratch
- Need clean data for demo/testing
- Foreign key constraint errors

**Command**:
```bash
# Linux/Mac
./run-local-dev.sh --reset

# Windows
.\run-local-dev.ps1 -Reset
```

**What happens**:
1. Asks for confirmation (‚ö†Ô∏è **deletes all data**)
2. Deletes `backend/contravento_dev.db`
3. Runs Alembic migrations from scratch
4. Recreates test users
5. Reseeds achievements and cycling types

**When to use**:
- After creating new Alembic migrations
- Data corruption or schema conflicts
- Want fresh data for testing

---

### Command Reference

#### Linux/Mac (Bash)

```bash
# Start backend only (most common)
./run-local-dev.sh

# Start backend + frontend
./run-local-dev.sh --with-frontend

# First-time setup (or after dependency changes)
./run-local-dev.sh --setup

# Reset database (delete all data)
./run-local-dev.sh --reset

# Show help
./run-local-dev.sh --help
```

#### Windows (PowerShell)

```powershell
# Start backend only (most common)
.\run-local-dev.ps1

# Start backend + frontend
.\run-local-dev.ps1 -WithFrontend

# First-time setup (or after dependency changes)
.\run-local-dev.ps1 -Setup

# Reset database (delete all data)
.\run-local-dev.ps1 -Reset

# Show help
.\run-local-dev.ps1 -Help
```

---

### Process Management

#### Check if Services are Running

**Linux/Mac**:
```bash
# Check backend (port 8000)
lsof -i:8000

# Check frontend (port 5173)
lsof -i:5173

# View all Python processes (backend)
ps aux | grep uvicorn

# View all Node processes (frontend)
ps aux | grep node
```

**Windows PowerShell**:
```powershell
# Check backend (port 8000)
Get-NetTCPConnection -LocalPort 8000

# Check frontend (port 5173)
Get-NetTCPConnection -LocalPort 5173

# View all Python processes
Get-Process | Where-Object {$_.ProcessName -like "*python*"}

# View all Node processes
Get-Process | Where-Object {$_.ProcessName -like "*node*"}
```

#### Manually Stop Services

**Linux/Mac**:
```bash
# Kill backend (port 8000)
lsof -ti:8000 | xargs kill -9

# Kill frontend (port 5173)
lsof -ti:5173 | xargs kill -9

# Kill all uvicorn processes
pkill -f uvicorn

# Kill all node processes
pkill -f node
```

**Windows PowerShell**:
```powershell
# Kill backend (port 8000)
Get-Process -Id (Get-NetTCPConnection -LocalPort 8000).OwningProcess | Stop-Process

# Kill frontend (port 5173)
Get-Process -Id (Get-NetTCPConnection -LocalPort 5173).OwningProcess | Stop-Process

# Kill all Python processes
Get-Process | Where-Object {$_.ProcessName -like "*python*"} | Stop-Process

# Kill all Node processes
Get-Process | Where-Object {$_.ProcessName -like "*node*"} | Stop-Process
```

#### Verify Connectivity

```bash
# Check backend health
curl http://localhost:8000/health

# Check API documentation
curl http://localhost:8000/docs

# Check frontend
curl http://localhost:5173

# Test specific endpoint
curl -X GET http://localhost:8000/api/cycling-types
```

---

## Architecture

### Component Stack

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend (Optional - with --with-frontend)   ‚îÇ
‚îÇ   Vite Dev Server - Port 5173                  ‚îÇ
‚îÇ   ‚Ä¢ React 18 + TypeScript                      ‚îÇ
‚îÇ   ‚Ä¢ Hot Module Replacement (HMR)               ‚îÇ
‚îÇ   ‚Ä¢ Proxies /api/* ‚Üí http://localhost:8000     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì HTTP Proxy
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Backend - Port 8000                           ‚îÇ
‚îÇ   FastAPI + uvicorn --reload                    ‚îÇ
‚îÇ   ‚Ä¢ Auto-restart on .py changes                 ‚îÇ
‚îÇ   ‚Ä¢ OpenAPI docs at /docs                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Database                                      ‚îÇ
‚îÇ   SQLite 3 - File-based                         ‚îÇ
‚îÇ   ‚Ä¢ Location: backend/contravento_dev.db        ‚îÇ
‚îÇ   ‚Ä¢ Async access with aiosqlite                 ‚îÇ
‚îÇ   ‚Ä¢ Migrations: Alembic                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Data Flow

1. **Frontend** (http://localhost:5173)
   - User interacts with React UI
   - API calls to `/api/*` are proxied to backend

2. **Vite Proxy** (automatic)
   - Rewrites `/api/trips` ‚Üí `http://localhost:8000/api/trips`
   - Eliminates CORS issues

3. **Backend** (http://localhost:8000)
   - FastAPI processes request
   - SQLAlchemy ORM queries database
   - Returns JSON response

4. **Database** (SQLite file)
   - Stores data in `backend/contravento_dev.db`
   - Async queries via `aiosqlite`

### File Structure

```
contravento-application-python/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ src/                  # Source code
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/             # FastAPI routers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/          # SQLAlchemy models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/         # Pydantic schemas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/        # Business logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py          # Application entry point
‚îÇ   ‚îú‚îÄ‚îÄ migrations/          # Alembic migrations
‚îÇ   ‚îú‚îÄ‚îÄ storage/             # Uploaded files
‚îÇ   ‚îú‚îÄ‚îÄ tests/               # pytest tests
‚îÇ   ‚îú‚îÄ‚îÄ .env                 # Environment variables (created by --setup)
‚îÇ   ‚îú‚îÄ‚îÄ contravento_dev.db   # SQLite database (created by --setup)
‚îÇ   ‚îî‚îÄ‚îÄ pyproject.toml       # Poetry dependencies
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ src/                 # React source code
‚îÇ   ‚îú‚îÄ‚îÄ .env.development     # Frontend env (created by --setup)
‚îÇ   ‚îú‚îÄ‚îÄ vite.config.ts       # Vite configuration (proxy settings)
‚îÇ   ‚îî‚îÄ‚îÄ package.json         # npm dependencies
‚îú‚îÄ‚îÄ run-local-dev.sh         # Bash startup script
‚îî‚îÄ‚îÄ run-local-dev.ps1        # PowerShell startup script
```

### Database Schema

SQLite stores the following tables (via Alembic migrations):

- **users** - User accounts
- **user_profiles** - Extended profile data
- **user_stats** - Cycling statistics
- **trips** - Travel diary entries
- **trip_photos** - Trip photo metadata
- **trip_locations** - GPS coordinates
- **tags** - Trip categorization
- **achievements** - Cycling achievements
- **cycling_types** - Types of cycling

**Inspect database**:
```bash
sqlite3 backend/contravento_dev.db
sqlite> .tables
sqlite> SELECT * FROM users;
sqlite> .quit
```

Or use GUI tools like [DB Browser for SQLite](https://sqlitebrowser.org/).

---

## Troubleshooting

### Port Already in Use Errors

#### Error: "Port 8000 is already in use"

**Cause**: Another process is using port 8000 (usually a zombie uvicorn process)

**Fix (Linux/Mac)**:
```bash
# Find and kill the process
lsof -ti:8000 | xargs kill -9
```

**Fix (Windows)**:
```powershell
Get-Process -Id (Get-NetTCPConnection -LocalPort 8000).OwningProcess | Stop-Process
```

---

#### Error: "Port 5173 is already in use"

**Cause**: Another Vite dev server or process using port 5173

**Fix (Linux/Mac)**:
```bash
lsof -ti:5173 | xargs kill -9
```

**Fix (Windows)**:
```powershell
Get-Process -Id (Get-NetTCPConnection -LocalPort 5173).OwningProcess | Stop-Process
```

---

### Dependency Issues

#### Error: "Poetry not found"

**Cause**: Poetry is not installed

**Fix**:
```bash
# Install with pip
pip install poetry

# Or with pipx (recommended)
pipx install poetry

# Verify installation
poetry --version
```

---

#### Error: "Node.js not found" (with --with-frontend)

**Cause**: Node.js is not installed or not in PATH

**Fix**:
1. Download Node.js 18+ from https://nodejs.org/
2. Install the package
3. Verify: `node --version`
4. Restart terminal and try again

---

#### Error: "npm install failed" (frontend)

**Cause**: Dependency conflicts or corrupted cache

**Fix**:
```bash
cd frontend
rm -rf node_modules package-lock.json
npm install
cd ..
```

---

### Database Issues

#### Error: ".env not found"

**Cause**: Setup was not run or `.env` was deleted

**Fix**:
```bash
./run-local-dev.sh --setup
```

---

#### Error: "Database migration failed"

**Cause**: Alembic migration conflicts or schema mismatch

**Fix 1 - Reset database (recommended)**:
```bash
./run-local-dev.sh --reset
```

**Fix 2 - Manual migration**:
```bash
cd backend
poetry run alembic history       # View migration history
poetry run alembic current       # View current version
poetry run alembic upgrade head  # Apply pending migrations
```

---

### Hot Reload Issues

#### Backend not reloading automatically

**Cause**: uvicorn `--reload` not working or process hung

**Fix 1 - Restart script**:
```bash
# Press Ctrl+C to stop
./run-local-dev.sh
```

**Fix 2 - Check process**:
```bash
# Linux/Mac
ps aux | grep uvicorn

# Windows
Get-Process | Where-Object {$_.ProcessName -like "*python*"}
```

---

#### Frontend not reloading (HMR not working)

**Cause**: Vite HMR WebSocket connection issue

**Fix 1 - Verify port**:
```bash
lsof -i:5173  # Should show Vite process
```

**Fix 2 - Clear Vite cache**:
```bash
cd frontend
rm -rf node_modules/.vite
npm run dev
```

**Fix 3 - Check browser console**:
- Open DevTools (F12)
- Look for WebSocket errors
- Try hard refresh (Ctrl+Shift+R)

---

### CORS Errors (with --with-frontend)

#### Error: "CORS policy: No 'Access-Control-Allow-Origin' header"

**Cause**: Vite proxy not configured correctly

**Fix - Verify proxy configuration** in `frontend/vite.config.ts`:
```typescript
export default defineConfig({
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
        secure: false,
      }
    }
  }
});
```

**Check**:
1. Frontend is at http://localhost:5173 (not another port)
2. Backend is at http://localhost:8000
3. Browser is accessing frontend via proxy (not directly calling backend)

---

### Common Questions

**Q: When should I use --setup?**

A: Run `--setup` when:
- First time cloning the repository
- After major dependency changes (new `pyproject.toml` or `package.json`)
- After `git pull` with new migrations
- `.env` file is missing or corrupted

**Q: When should I use --reset?**

A: Run `--reset` when:
- Database is corrupted or has inconsistent data
- Testing new Alembic migrations from scratch
- You want clean test data
- Foreign key constraint errors

**Q: Can I run frontend without backend?**

A: No. The frontend depends on backend for authentication and data. Running `npm run dev` directly will start the UI, but all API calls will fail.

**Q: What's the difference vs. Docker modes?**

| Feature | local-dev | Docker (local-minimal/local-full) |
|---------|-----------|-----------------------------------|
| **Startup** | <30 seconds | 60-90 seconds |
| **Database** | SQLite (file) | PostgreSQL (container) |
| **Isolation** | Shares OS environment | Isolated containers |
| **Redis** | No | Yes (local-full only) |
| **MailHog** | No | Yes (local-full only) |
| **Recommended use** | Daily development | Integration testing |

**Q: Do code changes reload automatically?**

A: **Yes**, both backend and frontend:
- **Backend**: uvicorn `--reload` restarts on `.py` changes (~5 seconds)
- **Frontend**: Vite HMR updates browser in <2 seconds **without page reload**

**Q: How do I stop the services?**

A: Press `Ctrl+C` in the terminal. The script automatically cleans up both backend and frontend processes.

**Q: Can I run multiple instances?**

A: No, not on the default ports (8000 and 5173). For multiple instances, use Docker with different profiles or modify ports in configuration.

**Q: Where is the SQLite database file?**

A: `backend/contravento_dev.db` (binary file)

Inspect with:
```bash
sqlite3 backend/contravento_dev.db
sqlite> .tables
sqlite> SELECT * FROM users;
```

Or use [DB Browser for SQLite](https://sqlitebrowser.org/).

**Q: What files should I NOT commit to Git?**

‚ùå **NEVER commit**:
- `backend/contravento_dev.db` (local database)
- `backend/.env` (local credentials)
- `frontend/.env.staging` (staging credentials)
- `frontend/.env.production` (production credentials)
- `frontend/node_modules/` (dependencies)
- `backend/__pycache__/` (Python cache)

‚úÖ **DO commit**:
- `backend/.env.dev.example` (template)
- `frontend/.env.development.example` (template)
- `frontend/.env.staging.example` (template)
- `frontend/.env.production.example` (template)

---

## Related Modes

### Progression Path

```
local-dev (SQLite)
    ‚Üì
[You are here - fastest option for daily dev]
    ‚Üì
When you need PostgreSQL testing:
    ‚Üí local-minimal (Docker + PostgreSQL only)
    ‚Üì
When you need email/cache testing:
    ‚Üí local-full (Docker + PostgreSQL + MailHog + Redis)
    ‚Üì
When deploying to server:
    ‚Üí dev (Integration server)
    ‚Üí staging (Pre-production)
    ‚Üí prod (Live production)
```

### When to Upgrade

**From local-dev to [local-minimal](local-minimal.md)**:
- Need to test PostgreSQL-specific features (ARRAY columns, native UUIDs)
- Validating database migrations before deployment
- Testing production database parity

**From local-dev to [local-full](local-full.md)**:
- Implementing email features (registration, password reset)
- Testing Redis caching or sessions
- Need pgAdmin for database inspection
- Full integration testing before staging

**From local-dev to [dev](dev.md)**:
- Setting up shared development server
- Testing Nginx reverse proxy
- Real SMTP email sending

### Quick Comparison

| Feature | local-dev | local-minimal | local-full |
|---------|-----------|---------------|------------|
| **Startup** | Instant | ~10s | ~20-30s |
| **Database** | SQLite | PostgreSQL | PostgreSQL |
| **Docker** | ‚ùå | ‚úÖ | ‚úÖ |
| **MailHog** | ‚ùå | ‚ùå | ‚úÖ |
| **pgAdmin** | ‚ùå | ‚ùå | ‚úÖ |
| **Redis** | ‚ùå | ‚ùå | ‚úÖ |
| **Best for** | Daily dev | PostgreSQL testing | Email/cache testing |

---

## Additional Resources

- **[Getting Started Guide](../guides/getting-started.md)** - General deployment introduction
- **[Environment Variables Guide](../guides/environment-variables.md)** - Complete .env reference
- **[Database Management Guide](../guides/database-management.md)** - Migrations, seeds, backups
- **[Troubleshooting Guide](../guides/troubleshooting.md)** - Cross-mode common issues
- **[Deployment Index](../README.md)** - All deployment modes

---

**Need more help?** Check the [Troubleshooting Guide](../guides/troubleshooting.md) or open an issue on GitHub.

**Last Updated**: 2026-01-25
