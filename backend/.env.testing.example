# =============================================================================
# ContraVento Backend - TESTING Environment Variables
# =============================================================================
# This template is for PostgreSQL testing environment (minimal setup)
# Use this to test PostgreSQL compatibility before staging
# Copy to .env.testing and customize values

# =============================================================================
# APPLICATION
# =============================================================================

APP_NAME=ContraVento-Testing
APP_ENV=testing
DEBUG=true  # Enable debug mode to see detailed errors

# =============================================================================
# DATABASE - PostgreSQL (Testing)
# =============================================================================

# PostgreSQL Docker Container Configuration
# These variables configure the PostgreSQL container itself
POSTGRES_DB=contravento_test
POSTGRES_USER=contravento_test
POSTGRES_PASSWORD=test_password
POSTGRES_PORT=5432

# PostgreSQL connection URL for backend/alembic
# Must match the container configuration above
DATABASE_URL=postgresql+asyncpg://contravento_test:test_password@localhost:5432/contravento_test

# Note: When using --env-file with docker-compose, these variables
# automatically configure PostgreSQL. No manual database creation needed!

# =============================================================================
# SECURITY - JWT & AUTHENTICATION
# =============================================================================

# Secret key for JWT signing (simple for testing, not for production)
SECRET_KEY=test-secret-key-min-32-characters-for-jwt-signing-do-not-use-in-production

# JWT algorithm
ALGORITHM=HS256

# Token expiration
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=30

# =============================================================================
# SECURITY - PASSWORD HASHING
# =============================================================================

# Bcrypt rounds (4 is faster for testing, production uses 12)
BCRYPT_ROUNDS=4

# =============================================================================
# EMAIL / SMTP - Testing
# =============================================================================

# Option 1: No email (fails silently or skips email tests)
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM=test@contravento.com
SMTP_TLS=false

# Option 2: MailHog (if running)
# Start MailHog: docker run -d -p 1025:1025 -p 8025:8025 mailhog/mailhog
# SMTP_HOST=localhost
# SMTP_PORT=1025

# =============================================================================
# FILE STORAGE
# =============================================================================

# Storage path (local for testing)
STORAGE_PATH=./storage_test

# Upload limits
UPLOAD_MAX_SIZE_MB=5
PROFILE_PHOTO_SIZE=400

# =============================================================================
# TRAVEL DIARY - SETTINGS
# =============================================================================

MAX_PHOTOS_PER_TRIP=20
MAX_TAGS_PER_TRIP=10

# Photo quality settings
PHOTO_QUALITY_OPTIMIZED=85
PHOTO_QUALITY_THUMB=80
PHOTO_MAX_WIDTH=1200
PHOTO_THUMB_SIZE=200

# =============================================================================
# CORS - Testing (Allow all localhost ports)
# =============================================================================

CORS_ORIGINS=http://localhost:3000,http://localhost:5173,http://localhost:8080,http://localhost:8000

# =============================================================================
# RATE LIMITING - Relaxed for testing
# =============================================================================

LOGIN_MAX_ATTEMPTS=10  # More attempts for testing
LOGIN_LOCKOUT_MINUTES=5  # Shorter lockout
VERIFICATION_EMAIL_MAX_PER_HOUR=10

# =============================================================================
# LOGGING
# =============================================================================

# Log level (DEBUG to see everything)
LOG_LEVEL=DEBUG

# Log format (text is easier to read during testing)
LOG_FORMAT=text

# =============================================================================
# SERVER
# =============================================================================

HOST=0.0.0.0
PORT=8000

# =============================================================================
# TESTING QUICK START INSTRUCTIONS
# =============================================================================
#
# 1. Copy this file:
#    cp .env.testing.example .env.testing
#
# 2. Start PostgreSQL with the testing configuration:
#    docker-compose --env-file backend/.env.testing up postgres -d
#
#    This automatically creates:
#    - Database: contravento_test
#    - User: contravento_test
#    - Password: test_password
#
# 3. Apply migrations:
#    export DATABASE_URL="postgresql+asyncpg://contravento_test:test_password@localhost:5432/contravento_test"
#    cd backend
#    poetry run alembic upgrade head
#
# 4. Start backend:
#    poetry run uvicorn src.main:app --reload --port 8000
#
# 5. Run tests:
#    poetry run pytest
#
# 6. Clean up:
#    docker-compose down
#    docker-compose down -v  # To delete data
#
# Alternative: Use automated script
#    bash backend/scripts/setup-postgres-testing.sh      # Linux/Mac
#    .\backend\scripts\setup-postgres-testing.ps1        # Windows
#
# =============================================================================
